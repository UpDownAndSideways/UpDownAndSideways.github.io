import React, { useCallback, useState } from 'react';

// Mock data for the business card and VCF file
const CONTACT_INFO = {
  name: "Jonathan Danner",
  title: "Brand Designer", // Keeping title/company for VCF structure, adjust if needed
  phone: "6827046494",
  email: "JDanner098@gmail.com",
  website: "https://www.jonathandanner.com"
};

// The URL for the new business card image
const CARD_IMAGE_URL = "https://i.ibb.co/tTFTGSTy/envato-graphic-a54d1f6c-7ea2-47a2-bf5c-831509658566.png";

/**
 * Generates the VCF content string from the contact data.
 * @returns {string} The VCF content.
 */
const generateVcfContent = () => {
  const { name, title, company, phone, email, website } = CONTACT_INFO;
  
  // VCF 3.0 Standard Format
  return `BEGIN:VCARD
VERSION:3.0
FN:${name}
ORG:${company}
TITLE:${title}
TEL;TYPE=WORK,VOICE:${phone}
EMAIL;TYPE=PREF,INTERNET:${email}
URL:${website}
END:VCARD`;
};

/**
 * The main application component for the 3D Business Card Website.
 */
const App = () => {
  // State to store the current rotation of the card, updated by mouse movement
  const [rotation, setRotation] = useState({ x: 0, y: 0 });
  
  // Handles the card click event and triggers the VCF file download.
  const handleDownload = useCallback(() => {
    const vcfContent = generateVcfContent();
    const blob = new Blob([vcfContent], { type: 'text/vcard;charset=utf-8' });
    
    // Create a temporary link element to trigger the download
    const link = document.createElement('a');
    link.href = URL.createObjectURL(blob);
    // VCF file name updated to use the new name
    link.download = `${CONTACT_INFO.name.replace(/\s/g, '_')}.vcf`;

    // Append to body, click, and remove
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);

    console.log(`VCF file for ${CONTACT_INFO.name} downloaded successfully.`);
  }, []);

  // Handles mouse movement across the screen to calculate parallax rotation
  const handleMouseMove = useCallback((e) => {
    const { clientX, clientY } = e;
    const { innerWidth, innerHeight } = window;

    // Calculate position relative to the center of the viewport (from -0.5 to 0.5)
    const offsetX = (clientX - innerWidth / 2) / innerWidth;
    const offsetY = (clientY - innerHeight / 2) / innerHeight;

    // Map offset to rotation degree. Max rotation of 15 degrees.
    // The rotation is inverse: moving mouse right (positive offsetX) should rotate the card left (negative Y)
    // Moving mouse up (negative offsetY) should rotate the card down (positive X)
    const maxRotation = 15;
    const rotY = -offsetX * maxRotation;
    const rotX = offsetY * maxRotation; 

    setRotation({ x: rotX, y: rotY });
  }, []);
  
  return (
    // The onMouseMove handler is placed on the main container to capture movement across the whole viewport
    <div 
      className="min-h-screen flex flex-col items-center justify-center p-4"
      style={{ background: 'linear-gradient(to bottom right, #ffffff, #f0f0f0)' }} // White gradient background
      onMouseMove={handleMouseMove}
      onMouseLeave={() => setRotation({ x: 0, y: 0 })} // Reset rotation when mouse leaves the viewport
    >
      <style>
        {`
        .floating-card {
            background-size: cover; 
            background-position: center; 
            /* Kept transition for smooth mouse movement, but removed hover styles */
            transition: transform 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94), box-shadow 0.2s ease-out;
        }

        /* Removed .floating-card:hover block completely as requested */
        `}
      </style>
      
      {/* The 3D Card Container */}
      <div 
        className="
          floating-card 
          w-[90vw] max-w-sm h-60 md:h-72 
          rounded-2xl p-0
          cursor-pointer transform-gpu 
          shadow-xl /* Initial shadow */
          relative
          overflow-hidden
        "
        style={{ 
          backgroundImage: `url(${CARD_IMAGE_URL})`,
          // Dynamic transform to react to mouse movement (parallax effect)
          transform: `perspective(1000px) rotateX(${rotation.x}deg) rotateY(${rotation.y}deg)`,
        }}
        onClick={handleDownload}
        role="button"
        tabIndex="0"
        aria-label="Click to download VCF contact file"
      >
        {/* Download Instruction Overlay is removed as its visual cue relied on hover */}
      </div>
    </div>
  );
};

export default App;
